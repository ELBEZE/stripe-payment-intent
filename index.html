<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Empreinte de Carte Bancaire</title>
    <script src="https://js.stripe.com/v3/"></script>
    <style>
      body {
        font-family: sans-serif;
        padding: 20px;
      }

      .success-message {
        display: none;
        margin-top: 20px;
        padding: 10px;
        border-radius: 5px;
        background-color: #e0ffe0;
        color: #006600;
        font-weight: bold;
      }

      #chargement {
        display: none;
        margin-top: 15px;
        font-weight: bold;
        color: #444;
      }
    </style>
  </head>
  <body>
    <h1>Empreinte de Carte Bancaire</h1>

    <form id="payment-form">
      <div id="payment-element">
        <!-- Stripe injectera le champ ici -->
      </div>
      <button id="submit">Valider</button>
    </form>

    <!-- Message de chargement -->
    <div id="chargement">⏳ Merci de patienter pendant l’enregistrement de votre empreinte bancaire…</div>

    <!-- Message de succès -->
    <div id="success-message" class="success-message">✅ Empreinte enregistrée avec succès !</div>

    <script>
      const stripe = Stripe("pk_test_…"); // ← ta clé publique ici
      const options = {
        clientSecret: "pi_…_secret_…", // ← ton client secret ici
      };

      const elements = stripe.elements(options);
      const paymentElement = elements.create("payment");
      paymentElement.mount("#payment-element");

      const form = document.getElementById("payment-form");
      const messageChargement = document.getElementById("chargement");
      const successMessage = document.getElementById("success-message");

      form.addEventListener("submit", async (event) => {
        event.preventDefault();

        // Affiche "Merci de patienter…" immédiatement
        messageChargement.style.display = "block";

        const { error } = await stripe.confirmPayment({
          elements,
          confirmParams: {
            return_url: window.location.href, // facultatif, ici on reste sur place
          },
          redirect: "if_required",
        });

        // Masque le message de chargement
        messageChargement.style.display = "none";

        if (error) {
          alert(error.message);
        } else {
          successMessage.style.display = "block";
        }
      });
    <script>
  const stripe = Stripe('pk_test_51RoWOb1ASDwMqR4fOhDUI7Gq2prQNCAPCnZbgfZhaWkqHaVadEMLA0iLSTNr2DZJWOf4DonrY5sc3mtEwXs3dPpe00z07TynFD'); // ← Mets ici ta vraie clé publique Stripe

  const elements = stripe.elements();
  const card = elements.create('card');
  card.mount('#card-element');

  const form = document.getElementById('payment-form');
  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    // 1. Appelle ton serveur pour créer un PaymentIntent
    const response = await fetch('/create-payment-intent', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({}) // tu pourrais ajouter un montant ou nom si besoin
    });

    const { clientSecret } = await response.json();

    // 2. Confirme l’empreinte (sans capture)
    const result = await stripe.confirmCardPayment(clientSecret, {
      payment_method: {
        card: card,
        billing_details: {
          name: document.getElementById('name').value
        }
      }
    });

    if (result.error) {
      document.getElementById('card-errors').textContent = result.error.message;
    } else {
      if (result.paymentIntent.status === 'requires_capture') {
        alert("✅ Empreinte enregistrée avec succès !");
      }
    }
  });
</script>
